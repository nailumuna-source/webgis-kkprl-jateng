<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>WebGIS KKPRL Jawa Tengah</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Leaflet Search -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.4/dist/leaflet-search.min.css"/>
<script src="https://unpkg.com/leaflet-search@3.0.4/dist/leaflet-search.min.js"></script>

<style>
html, body {
  margin: 0;
  height: 100%;
}
#map {
  width: 100%;
  height: 100%;
}
</style>
</head>

<body>
<div id="map"></div>

<script>
/* =========================
   MAP & BASEMAP
========================= */
const map = L.map('map').setView([-6.9, 110.4], 9);

L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Â© Esri' }
).addTo(map);

/* =========================
   WARNA PER NAMA SUBJEK
========================= */
const colorPalette = [
  '#e6194b', '#f58231', '#911eb4', '#f032e6',
  '#9a6324', '#800000', '#ffe119', '#fabed4',
  '#ffd8b1', '#bfef45'
];

let subjectColors = {};
let colorIndex = 0;

function getColorBySubject(subject) {
  if (!subjectColors[subject]) {
    subjectColors[subject] = colorPalette[colorIndex % colorPalette.length];
    colorIndex++;
  }
  return subjectColors[subject];
}

/* =========================
   STYLE KKPRL
========================= */
function kkprlStyle(feature) {
  const subject = feature.properties.NAMA_SUBJ || 'LAINNYA';
  return {
    fillColor: getColorBySubject(subject),
    color: '#333',
    weight: 1,
    fillOpacity: 0.7
  };
}

/* =========================
   POPUP
========================= */
function kkprlPopup(feature, layer) {
  const p = feature.properties;
  layer.bindPopup(`
    <b>No KKPRL:</b> ${p.NO_KKPRL || '-'}<br>
    <b>Nama Subjek:</b> ${p.NAMA_SUBJ || '-'}<br>
    <b>Kegiatan:</b> ${p.KEGIATAN || '-'}<br>
    <b>Provinsi:</b> ${p.PROVINSI || '-'}<br>
    <b>Perairan:</b> ${p.PERAIRAN || '-'}<br>
    <b>Luas (Ha):</b> ${p.LUAS_HA || '-'}
  `);
}

/* =========================
   LOAD KKPRL
========================= */
fetch('data/kkprl_jawa.geojson')
  .then(res => res.json())
  .then(data => {

    const kkprlLayer = L.geoJSON(data, {
      style: kkprlStyle,
      onEachFeature: kkprlPopup
    }).addTo(map);

    map.fitBounds(kkprlLayer.getBounds());

    // Search by NAMA_SUBJ
    const searchControl = new L.Control.Search({
      layer: kkprlLayer,
      propertyName: 'NAMA_SUBJ',
      marker: false,
      moveToLocation: function(latlng) {
        map.setView(latlng, 12);
      }
    });
    map.addControl(searchControl);
  })
  .catch(err => console.error('Error KKPRL:', err));
</script>

</body>
</html>
