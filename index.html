<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>WebGIS KKPRL</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Leaflet Search -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-search@3.0.4/dist/leaflet-search.min.css" />
  <script src="https://unpkg.com/leaflet-search@3.0.4/dist/leaflet-search.min.js"></script>

  <style>
    html, body {
      margin: 0;
      height: 100%;
    }
    #map {
      width: 100%;
      height: 100%;
    }
  </style>
</head>

<body>
<div id="map"></div>

<script>
/* =========================
   BASEMAP
========================= */
const map = L.map('map').setView([-6.9, 110.4], 9);

const esriSatellite = L.tileLayer(
  'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
  { attribution: 'Â© Esri' }
).addTo(map);

/* =========================
   WARNA (ANTI BIRU & HIJAU)
========================= */
const colorPalette = [
  '#e6194b', // merah
  '#f58231', // oranye
  '#911eb4', // ungu
  '#f032e6', // pink
  '#9a6324', // coklat
  '#800000', // maroon
  '#ffe119', // kuning
  '#fabed4', // soft pink
  '#ffd8b1', // peach
  '#bfef45'  // lime kekuningan
];

let subjectColors = {};
let colorIndex = 0;

function getColorBySubject(subject) {
  if (!subjectColors[subject]) {
    subjectColors[subject] = colorPalette[colorIndex % colorPalette.length];
    colorIndex++;
  }
  return subjectColors[subject];
}

/* =========================
   STYLE FEATURE
========================= */
function styleFeature(feature) {
  const subject = feature.properties.nama_subjek || 'Tidak Diketahui';

  return {
    fillColor: getColorBySubject(subject),
    weight: 1,
    opacity: 1,
    color: '#333',
    fillOpacity: 0.7
  };
}

/* =========================
   POPUP
========================= */
function onEachFeature(feature, layer) {
  const p = feature.properties;

  layer.bindPopup(`
    <b>Nama Subjek:</b> ${p.nama_subjek || '-'}<br>
    <b>Provinsi:</b> ${p.provinsi || '-'}<br>
    <b>Keterangan:</b> ${p.keterangan || '-'}
  `);
}

/* =========================
   LOAD GEOJSON
========================= */
const kkprlLayer = L.layerGroup().addTo(map);

fetch('data/kkprl.geojson')
  .then(response => response.json())
  .then(data => {

    const geojson = L.geoJSON(data, {
      style: styleFeature,
      onEachFeature: onEachFeature
    }).addTo(kkprlLayer);

    map.fitBounds(geojson.getBounds());

    /* =========================
       SEARCH
    ========================= */
    const searchControl = new L.Control.Search({
      layer: geojson,
      propertyName: 'nama_subjek',
      marker: false,
      moveToLocation: function(latlng, title, map) {
        map.setView(latlng, 12);
      }
    });

    map.addControl(searchControl);
  });

/* =========================
   LAYER CONTROL
========================= */
const overlayMaps = {
  "KKPRL": kkprlLayer
};

L.control.layers(null, overlayMaps, {
  collapsed: false
}).addTo(map);

</script>
</body>
</html>
